# 共通指示 - 要件ベースコード実装ワークフロー

## 🎯 全エージェント共通ルール

### 基本原則
- **明確性**: 全ての指示は具体的で実行可能であること
- **一貫性**: 全エージェント間で統一されたフォーマットを使用
- **トレーサビリティ**: 全ての処理を記録・追跡可能にする
- **効率性**: 無駄のない最小限の処理で最大の成果を生み出す

### ファイル操作規則
- **エンコーディング**: 全ファイルUTF-8で作成
- **形式**: 構造化Markdown (`.md`) を基本とする
- **命名**: 英数字とアンダースコア、ハイフンのみ使用
- **保存場所**: 指定されたディレクトリ構造を厳守

### エラーハンドリング
- **継続実行**: エラー発生時も可能な限り処理を継続
- **詳細記録**: エラー内容を具体的にログに記録
- **復旧処理**: 可能な範囲での自動復旧を試行

## 📝 必須ログ記録

### 実行ログ記録 (毎回必須)
**毎回の実行終了後にログファイルに、以下の内容を書き込むこと。**(`agents/log_1.txt`, `agents/log_2.txt`, ...)

ログファイルは、300行を超えたら新しいファイルを作成すること。

**記録内容:**
- **実行日時**: YYYY-MM-DD HH:MM:SS
- **エージェント名**: 実行したエージェントの名前
- **出力ファイル一覧**: 作成したファイルの一覧
- **処理概要**: 実行した主要な処理の要約
- **エラー情報**: 発生したエラーがあれば詳細記録
- **実行時間**: 処理にかかった時間
- **次回への引き継ぎ事項**: 次のエージェントへの重要な情報

### 情報共有ファイル更新
**次回の実行時に役立つような情報を以下のファイルにメモすること。**

`agents/info.md`に以下の情報を記載・更新すること:
- 現在のワークスペースに関する情報を簡潔に記載
- OS・プログラミング言語のインストール有無
- 依存関係の状態
- 現在の実行フェーズ
- 重要な設定情報
- **制限**: 最大200行、必要最低限の情報のみ

**毎回の実行時に`agents/info.md`の内容を確認し、必要に応じて更新すること。**

## 🔄 ワークフロー連携

### フェーズ管理
- **Phase 1**: 要件確認 (requirement_clarifier)
- **Phase 2**: 対話管理 (dialogue_manager)
- **Phase 3**: タスク分析 (task_analyzer)
- **Phase 4**: 実行管理 (execution_manager)
- **Phase 5**: 品質評価 (quality_evaluator)

### データ引き継ぎ
- **入力ファイル確認**: 前フェーズの出力ファイルが存在するか必ず確認
- **形式検証**: 入力データが期待される形式・内容かチェック
- **欠損対応**: 必要なデータが不足している場合の対応手順を定義

### 状態管理
- **進捗状況**: 各フェーズの完了状況を明確に記録
- **中断・再開**: 処理中断時の状態保存と再開機能
- **依存関係**: 他エージェントとの依存関係を明確化

## 📋 品質チェック共通項目

### 出力ファイル品質
- [ ] 指定されたファイル形式で作成されているか
- [ ] 必要なセクションが全て含まれているか
- [ ] 内容が具体的で実行可能か
- [ ] 次のフェーズで利用可能な形式か
- [ ] エラーや警告がないか

### 処理品質
- [ ] 指定された入力を正しく読み込めたか
- [ ] 全ての必須処理が完了したか
- [ ] 適切なログが記録されたか
- [ ] 次フェーズへの引き継ぎ準備が完了したか

## 🚫 禁止事項

### 絶対禁止
- **無限ループ**: 終了条件のない反復処理禁止

### 制限事項
- **ファイル作成数**: 1回の実行で最大3ファイルまで
- **ファイルサイズ**: 単一ファイル最大1MB
- **処理時間**: 1エージェント最大10分以内
- **メモリ使用量**: 過度なメモリ消費の回避

## 🔧 変数システム活用

### 必須変数の使用
全プロンプトで以下の変数を適切に活用すること:
- `要件ベースコード実装ワークフロー`: プロジェクト名
- `{{agent_name}}`: 現在のエージェント名
- `INPUT/task.md`: 入力ファイルパス
- `sample/`: 出力ファイルパス
- `3`: 1回あたり最大ファイル作成数

### カスタム変数
プロジェクト固有の変数は `sample/variables.yaml` で定義・管理

## 💡 ベストプラクティス

### 効率的な実行
- **事前確認**: 必要なファイルが存在するか実行前にチェック
- **段階的処理**: 大きなタスクは小さな単位に分割
- **中間保存**: 長時間処理では途中結果を保存
- **検証**: 各ステップで結果を検証してから次に進む

### 保守性向上
- **明確な命名**: ファイル名・変数名は分かりやすく
- **適切なコメント**: 処理の意図を明確に記述
- **標準化**: 共通のフォーマット・規則を遵守
- **ドキュメント**: 重要な決定や変更は文書化

---

**重要**: これらの共通指示は全エージェントで必須遵守項目です。個別エージェントの指示と矛盾する場合は、この共通指示を優先してください。
