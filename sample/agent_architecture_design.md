# エージェント・アーキテクチャ設計書

## エージェント構成概要

本システムは、ユーザーのタスク入力からGitHub Copilot Chat用プロンプトを自動生成するための5つの専門エージェントで構成されます。各エージェントは単一責任原則に基づき、明確に分離された役割を持ち、順次実行によるワークフローを形成します。

### アーキテクチャ特徴
- **完全分離型設計**: 各エージェントは独立した専門性を持つ
- **段階的情報拡充**: 前段の出力が次段の入力となる設計
- **ループ実行対応**: 全工程の反復実行が可能
- **ファイルベース連携**: 標準化されたMarkdown形式での情報受け渡し

## 各エージェントの役割定義

### 1. タスク分析エージェント (Task Analyzer Agent)
**専門領域**: ユーザー入力の構造化分析と情報不足の特定

**主要責任**:
- ユーザーの自然言語タスク入力の解析
- 必要な詳細情報の特定と分類
- 情報収集のための効果的な質問生成
- タスクの複雑度と優先度の評価

**処理範囲**:
- 自然言語処理による意図抽出
- 作業分解構造（WBS）の初期設計
- 情報ギャップの識別

### 2. 情報収集エージェント (Information Collector Agent)
**専門領域**: ユーザーとの対話による情報収集と整理

**主要責任**:
- 構造化された質問の提示
- ユーザー回答の検証と整理
- 情報の完全性確認
- 追加質問の生成判断

**処理範囲**:
- 選択式・記述式質問の設計
- 回答内容の妥当性検証
- 情報収集の完了判定

### 3. エージェント選定エージェント (Agent Selector Agent)
**専門領域**: タスクに最適な実行エージェントの選定と組み合わせ

**主要責任**:
- 収集した情報に基づく作業分析
- 必要な専門エージェントの特定
- エージェント実行順序の決定
- 依存関係の分析

**処理範囲**:
- タスク分類と専門領域マッピング
- エージェント組み合わせの最適化
- 実行計画の策定

### 4. 共通プロンプト生成エージェント (Common Prompt Generator Agent)
**専門領域**: 全エージェント共通のベースプロンプト生成

**主要責任**:
- プロジェクト全体のコンテキスト定義
- 共通指示事項の統合
- 一貫性のある指示体系の構築
- 品質基準の設定

**処理範囲**:
- ユーザータスクの要約と目的明示
- 共通制約条件の定義
- 出力形式の標準化仕様

### 5. 個別プロンプト生成エージェント (Individual Prompt Generator Agent)
**専門領域**: 各実行エージェント用の専用プロンプト生成

**主要責任**:
- エージェント固有の指示生成
- 専門的な出力形式の定義
- 入力ファイルと出力ファイルの仕様
- 品質チェック項目の定義

**処理範囲**:
- 専門領域特有の詳細指示
- ファイル命名規則の適用
- パフォーマンス指標の設定

## ワークフロー図

```
[ユーザー入力] 
    ↓
[1. タスク分析エージェント]
    ↓
[2. 情報収集エージェント] ←→ [ユーザー対話]
    ↓
[3. エージェント選定エージェント]
    ↓
[4. 共通プロンプト生成エージェント]
    ↓
[5. 個別プロンプト生成エージェント]
    ↓
[生成プロンプト群] → [GitHub Copilot Chat実行]

※ 全工程をループ実行可能（継続的改善）
```

## データフロー仕様

### 入力ファイル
- **システム起動時**: `INPUT/task.md` (ユーザーの初期タスク記述)

### エージェント間ファイル受け渡し

#### 1. タスク分析エージェント
- **入力**: `INPUT/task.md`
- **出力**: `sample/task_analysis_result.md`

#### 2. 情報収集エージェント
- **入力**: `sample/task_analysis_result.md`
- **出力**: 
  - `sample/questions_for_user.md` (ユーザーへの質問)
  - `sample/collected_information.md` (収集した情報の統合)

#### 3. エージェント選定エージェント
- **入力**: `sample/collected_information.md`
- **出力**: `sample/selected_agents_plan.md`

#### 4. 共通プロンプト生成エージェント
- **入力**: 
  - `sample/collected_information.md`
  - `sample/selected_agents_plan.md`
- **出力**: `sample/common_prompt.md`

#### 5. 個別プロンプト生成エージェント
- **入力**: 
  - `sample/selected_agents_plan.md`
  - `sample/common_prompt.md`
- **出力**: `sample/individual_prompts/[agent_name].prompt.md` (複数ファイル)

### 最終出力
- **プロンプト統合ファイル**: `OUTPUT/generated_prompts_package.md`
- **実行手順書**: `OUTPUT/execution_guide.md`

## ループ実行仕様

### 実行順序
1. **順次実行**: エージェント1→2→3→4→5の順序で実行
2. **完了確認**: 各エージェントの出力ファイル生成確認
3. **品質検証**: 生成されたプロンプトの品質チェック
4. **ループ判定**: 改善が必要な場合は1に戻る

### ループ制御
- **継続条件**: ユーザーが改善を要求する場合
- **終了条件**: ユーザーが最終承認を行う場合
- **中断条件**: エラーまたは実行不可能な要求の場合

### 状態管理
- **実行履歴**: `sample/execution_history.md`
- **バージョン管理**: `sample/version_log.md`
- **改善ログ**: `sample/improvement_log.md`

## 品質基準

### 責任分離の明確性
- **単一機能原則**: 各エージェントは1つの明確な専門機能のみ担当
- **依存関係最小化**: エージェント間の結合度を最小限に抑制
- **インターフェース標準化**: ファイル形式とデータ構造の統一

### ワークフローの効率性
- **処理時間最適化**: 不要な重複処理の排除
- **情報再利用**: 前段結果の効果的活用
- **エラー回復**: 部分的失敗からの復旧メカニズム

### 拡張性保証
- **新エージェント追加**: 既存ワークフローへの影響最小化
- **機能拡張**: 各エージェントの独立した機能追加
- **カスタマイズ対応**: ユーザー固有要求への対応力

## 技術的考慮事項

### ファイル命名規則
- **接頭辞**: ステップ番号（例：`01_task_analysis_result.md`）
- **内容識別**: 機能と出力内容を反映した名前
- **バージョン管理**: 必要に応じてタイムスタンプ付与

### エラーハンドリング
- **検証チェック**: 各段階での出力妥当性確認
- **フォールバック**: 部分的失敗時の代替処理
- **ログ記録**: トラブルシューティング用の詳細ログ

### パフォーマンス最適化
- **並列処理不可**: 順次実行による確実性重視
- **メモリ効率**: ファイルベース処理による軽量化
- **レスポンス向上**: 中間結果の早期提示

---

**設計日**: 2025年7月23日  
**設計者**: アーキテクト設計エージェント  
**バージョン**: 1.0  
**次回レビュー予定**: プロトタイプ実装後
