# 要件ベースコード実装ワークフロー

## 📋 プロジェクト概要

**要件ベースコード実装ワークフロー**は、ユーザーの要件を体系的に分析し、段階的な対話を通じて明確化し、最終的にコード実装まで自動化するAIエージェントシステムです。

### 🎯 解決する課題
- 曖昧な要件から具体的な実装への変換プロセスの自動化
- ユーザーとの対話による要件の段階的明確化
- タスク分解と優先順位付けによる効率的な実行
- 品質評価による継続的な改善サイクル

### 💡 プロジェクトの価値
- **効率性**: 手動での要件分析・タスク分解時間を大幅削減
- **品質向上**: 体系的な品質評価による高品質な成果物
- **再現性**: 標準化されたワークフローによる一貫した結果
- **拡張性**: エージェント追加による機能拡張が容易

## 🏗️ システムアーキテクチャ

### エージェント構成
本システムは5つの専門エージェントで構成されています：

```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│  要件確認       │ →  │  対話管理       │ →  │  タスク分析     │
│  エージェント   │    │  エージェント   │    │  エージェント   │
└─────────────────┘    └─────────────────┘    └─────────────────┘
         ↓                       ↑                       ↓
         ↓              ┌─────────┘              ┌─────────────────┐
         ↓              │                        │  実行管理       │
         ↓              │                        │  エージェント   │
         ↓              │                        └─────────────────┘
         ↓              │                                ↓
┌─────────────────┐    │                        ┌─────────────────┐
│   INPUT/        │    └─── ユーザー回答 ←────── │  品質評価       │
│   task.md       │                              │  エージェント   │
└─────────────────┘                              └─────────────────┘
```

### ワークフロー概要
```
[要件確認] → [対話管理] → [タスク分析] → [実行管理] → [品質評価]
     ↓           ↑            ↓            ↓           ↓
    質問生成    回答受付    タスク分解    実装実行    品質確認
                 ↑                                     ↓
            ユーザー対話 ←─────────── [満足度判定] ←────┘
                                        ↓ (不満足)
                                   [タスク再実行]
```

## 🚀 クイックスタート

### 前提条件
- 初期要件を `INPUT/task.md` に記述済み
- プロジェクトファイル一式が配置済み

### 最短実行手順
1. **要件ファイルの確認**: `INPUT/task.md` の内容を確認
2. **要件確認エージェント実行**: 要件分析と質問生成
3. **質問への回答**: 生成された質問に `sample/user_answers.md` で回答
4. **残り4エージェントの順次実行**: 対話管理 → タスク分析 → 実行管理 → 品質評価

## 📋 詳細実行手順

### Phase 1: 要件確認 (`requirement_clarifier`)
**目的**: 初期要件の分析と明確化のための質問生成

**手順**:
1. `INPUT/task.md` を確認し、要件内容を把握
2. 要件確認エージェントを実行
3. 生成された `sample/clarification_questions.md` を確認

**必要な入力ファイル**:
- `INPUT/task.md` - ユーザー指定の初期要件

**出力ファイル**:
- `sample/clarification_questions.md` - 要件確認用の質問リスト

### Phase 2: 対話管理 (`dialogue_manager`)
**目的**: ユーザーとの対話による要件の段階的明確化

**手順**:
1. `sample/clarification_questions.md` の質問を確認
2. **手動作業**: 各質問に対する回答を `sample/user_answers.md` に記述
3. 対話管理エージェントを実行
4. 追加質問が生成された場合は、Step 2-3を繰り返し

**必要な入力ファイル**:
- `sample/clarification_questions.md` - 要件確認用の質問
- `sample/user_answers.md` - ユーザーからの回答（手動作成）

**出力ファイル**:
- `sample/dialogue_summary.md` - 対話履歴と確定要件
- `sample/additional_questions.md` - 追加質問（必要時のみ）

**注意点**:
- 最大5回まで対話ループが可能
- ユーザーが完了を宣言するまで継続

### Phase 3: タスク分析 (`task_analyzer`)
**目的**: 明確化された要件からタスクへの分解と優先度設定

**手順**:
1. `sample/dialogue_summary.md` の確定要件を確認
2. タスク分析エージェントを実行
3. 生成された `sample/task_breakdown.md` のタスクリストを確認

**必要な入力ファイル**:
- `sample/dialogue_summary.md` - 対話履歴と確定要件

**出力ファイル**:
- `sample/task_breakdown.md` - タスク分解結果と優先度

### Phase 4: 実行管理 (`execution_manager`)
**目的**: 高優先度タスクの実装実行

**手順**:
1. `sample/task_breakdown.md` のタスクリストを確認
2. 実行管理エージェントを実行
3. 実装ファイル群と実行結果レポートを確認

**必要な入力ファイル**:
- `sample/task_breakdown.md` - タスク分解結果

**出力ファイル**:
- `sample/execution_results.md` - 実行結果レポート
- 実装ファイル群 - 要件に応じた各種ファイル（code/, docs/ 等）

### Phase 5: 品質評価 (`quality_evaluator`)
**目的**: 実行結果の品質確認と満足度評価

**手順**:
1. `sample/execution_results.md` と実装ファイル群を確認
2. 品質評価エージェントを実行
3. `sample/quality_assessment.md` の評価結果を確認
4. 満足度が不十分な場合は、Phase 4から再実行

**必要な入力ファイル**:
- `sample/execution_results.md` - 実行結果レポート

**出力ファイル**:
- `sample/quality_assessment.md` - 最終品質評価レポート

## 📁 ファイル構成とデータフロー

### ディレクトリ構造
```
meta_prompt/
├── INPUT/
│   └── task.md                    # ユーザー初期要件
├── sample/
│   ├── clarification_questions.md # 要件確認質問
│   ├── user_answers.md           # ユーザー回答（手動作成）
│   ├── dialogue_summary.md       # 対話履歴・確定要件
│   ├── additional_questions.md   # 追加質問（必要時）
│   ├── task_breakdown.md         # タスク分解結果
│   ├── execution_results.md      # 実行結果レポート
│   └── quality_assessment.md     # 最終品質評価
├── code/
│   └── [実装ファイル群]           # エージェントが生成
└── docs/
    └── [ドキュメントファイル群]    # エージェントが生成
```

### データフロー図
```
INPUT/task.md
     ↓
clarification_questions.md
     ↓ + user_answers.md
dialogue_summary.md
     ↓
task_breakdown.md
     ↓
execution_results.md + 実装ファイル群
     ↓
quality_assessment.md
```

### ファイル役割詳細

#### 入力ファイル
- **`INPUT/task.md`**: プロジェクトの出発点となるユーザー要件
- **`sample/user_answers.md`**: 対話フェーズでユーザーが手動作成する回答ファイル

#### 中間ファイル（エージェント間データ交換）
- **`sample/clarification_questions.md`**: 要件確認エージェントが生成する質問リスト
- **`sample/dialogue_summary.md`**: 対話管理エージェントが生成する確定要件
- **`sample/additional_questions.md`**: 追加の明確化が必要な場合の質問
- **`sample/task_breakdown.md`**: タスク分析エージェントが生成するタスクリスト
- **`sample/execution_results.md`**: 実行管理エージェントが生成する実行レポート

#### 最終出力ファイル
- **`sample/quality_assessment.md`**: 品質評価エージェントが生成する最終評価
- **実装ファイル群**: 要件に応じてcode/やdocs/配下に生成される実装ファイル

### ファイル仕様
- **形式**: 構造化Markdown
- **エンコーディング**: UTF-8
- **必須要素**: メタデータ（作成日時、エージェント名、処理ステータス）

## 🔄 ループ実行メカニズム

### 対話ループ（Phase 2）
要件が十分に明確化されるまで質問-回答を反復:
```
質問生成 → ユーザー回答 → 追加確認判定
    ↑                         ↓ (Yes)
    └──── 追加質問生成 ←───────┘
              ↓ (No)
         タスク分析へ
```

**制御パラメータ**:
- 最大対話回数: 5回
- 完了条件: ユーザーの明示的完了宣言

### 実行品質ループ（Phase 4-5）
満足度が十分になるまでタスク実行-評価を反復:
```
タスク実行 → 結果評価 → 満足度判定
    ↑                      ↓ (不満足)
    └──── タスク再実行 ←────┘
             ↓ (満足)
            完了
```

**制御パラメータ**:
- 最大実行回数: 3回
- 完了条件: 要件実現度80%以上

## 🛠️ トラブルシューティング

### よくある問題と解決方法

#### 1. 要件確認エージェントが質問を生成しない
**原因**: `INPUT/task.md` の要件が不明確または空
**解決方法**: 
- `INPUT/task.md` に具体的な要件を記述
- 最低限の目的と期待する成果物を明記

#### 2. 対話ループが終了しない
**原因**: `sample/user_answers.md` での回答が不十分
**解決方法**:
- 各質問に対して具体的で詳細な回答を記述
- 不明な点は「不明」と明記して次のフェーズへ進行

#### 3. タスク分解が不適切
**原因**: 要件の明確化が不十分
**解決方法**:
- Phase 2に戻って追加の対話を実施
- より具体的な要件説明を追加

#### 4. 実行管理でエラーが発生
**原因**: タスクの依存関係や技術的制約
**解決方法**:
- `sample/execution_results.md` のエラーログを確認
- タスク分解を見直して再実行

#### 5. 品質評価で満足度が低い
**原因**: 要件とのミスマッチまたは実装品質
**解決方法**:
- 要件の再確認と調整
- 実行管理フェーズからの再実行

### デバッグ手順
1. **ファイル存在確認**: 各フェーズの入力ファイルが正しく生成されているか
2. **ファイル内容確認**: 生成されたファイルの内容が適切か
3. **実行順序確認**: 正しい順序でエージェントを実行しているか
4. **ループ制御確認**: 無限ループに陥っていないか

## ❓ FAQ

### Q1: どの程度詳細な要件を書けばよいですか？
**A**: 初期要件は概要レベルで構いません。具体的な詳細は対話フェーズで段階的に明確化されます。目的と期待する成果物を1-2段落で記述することから始めてください。

### Q2: 対話フェーズでの回答はどの程度詳しく書く必要がありますか？
**A**: 各質問に対して、知っている範囲で具体的に回答してください。不明な点は「不明」「要検討」等と記述し、エージェントに判断を委ねることも可能です。

### Q3: タスクの実行順序は変更できますか？
**A**: 基本的な5フェーズの順序は固定ですが、Phase 2（対話管理）とPhase 4-5（実行-品質評価）は反復可能です。必要に応じてループを活用してください。

### Q4: 生成されるファイルの数に制限はありますか？
**A**: 1回の実行で最大3ファイルまで生成可能です。大規模なプロジェクトの場合は、複数回に分けて実行することを推奨します。

### Q5: エラーが発生した場合はどこから再開すればよいですか？
**A**: エラーが発生したフェーズから再実行できます。ただし、入力ファイルに問題がある場合は、前のフェーズから見直すことを推奨します。

### Q6: プロジェクトの途中で要件を変更したい場合は？
**A**: Phase 2（対話管理）に戻って新しい要件を `sample/user_answers.md` に追記し、そのフェーズから再実行してください。

### Q7: 生成されたコードの品質が期待と違う場合は？
**A**: Phase 5（品質評価）で不満足の判定を行い、Phase 4から再実行されます。また、要件自体を見直したい場合は早い段階のフェーズから再実行も可能です。

## 📈 システムの特徴と利点

### 技術的特徴
- **モジュラー設計**: 各エージェントが独立して動作
- **ファイルベース通信**: 明確なデータフローと再現性
- **段階的実行**: フェーズごとの確認が可能
- **ループ対応**: 品質向上のための反復実行

### 利用価値
- **時間短縮**: 手動分析に比べて大幅な時間削減
- **品質向上**: 体系的なプロセスによる一貫した品質
- **学習効果**: ワークフローを通じたベストプラクティスの習得
- **再利用性**: 類似プロジェクトでの再利用が容易

---

*本システムは要件から実装まで一気通貫で支援するAIエージェントワークフローです。各フェーズを順次実行し、必要に応じてループを活用することで、高品質な成果物を効率的に生成できます。*
